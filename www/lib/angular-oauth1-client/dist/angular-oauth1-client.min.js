/*! angular-oauth1-client - v0.1.12 - 2016-06-06
* https://github.com/seanfisher/angular-oauth1-client
* Copyright (c) 2016 Sean Fisher; Licensed  */
!function(a,b,c){"use strict";b.module("oauth1Client",["LocalStorageModule"]).service("oauthPersistence",["localStorageService","$q",function(a,b){var c=this,d="oauth_token",e="oauth_token_secret";c.storeAccessToken=function(c){var f=b.defer();return a.set(d,c.oauth_token),a.set(e,c.oauth_token_secret),f.resolve(),f.promise},c.clearAccessToken=function(){a.remove(d),a.remove(e)},c.accessIsInStorage=function(b,c){a.get(d)&&a.get(e)?b():c()},c.getTokenAndSecret=function(b){b(a.get(d),a.get(e))}}]).factory("oauth1Signer",[function(){function a(a){for(var b="",c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",d=0;a>d;d++)b+=c.charAt(Math.floor(Math.random()*c.length));return b}return{create:function(c){return b.extend({token:null,tokenSecret:"",version:"1.0",signatureMethod:"HMAC-SHA1",method:"GET",timestamp:Math.floor(Date.now()/1e3),nonce:a(32),oauthParameters:function(){var a={oauth_consumer_key:this.consumerKey,oauth_nonce:this.nonce,oauth_timestamp:this.timestamp,oauth_signature_method:this.signatureMethod};return this.token&&(a.oauth_token=this.token),this.version&&(a.oauth_version=this.version),this.callbackUrl&&(a.oauth_callback=this.callbackUrl),this.verifier&&(a.oauth_verifier=this.verifier),this.scopes&&(a.scopes=this.scopes),a},queryStringFields:function(){var a=this.oauthParameters(),b=this.fields;return Object.keys(b||{}).map(function(c){return a[c]=b[c]}),a},queryString:function(){var a=this,b=a.queryStringFields();return Object.keys(b).sort().map(function(c){return c+"="+a.percentEncode(b[c])}).join("&")},urlEncoded:function(a){return Object.keys(a).map(function(b){return b+"="+encodeURIComponent(a[b])}).join("&")},headerEncoded:function(a){return Object.keys(a).map(function(b){return b+'="'+encodeURIComponent(a[b])+'"'}).join(", ")},urlEncodedFields:function(){return this.urlEncoded(this.fields)},authorizationHeader:function(){var a=this.oauthParameters();return a.oauth_signature=this.base64Signature(),this.headerEncoded(a)},urlAndFields:function(){var a=this.urlEncodedFields();return a?this.url+"?"+a:this.url},parameterEncoded:function(a){var b=this;return a.map(function(a){return b.percentEncode(a)}).join("&")},baseString:function(){return this.parameterEncoded([this.method,this.url,this.queryString()])},hmacKey:function(){return this.parameterEncoded([this.consumerSecret,this.tokenSecret])},hmac:function(a){var b=a&&a.hasOwnProperty("encoding")&&void 0!==a.encoding?a.encoding:"binary";if("undefined"!=typeof process){var c,d;return c=require("crypto"),d=c.createHmac("sha1",this.hmacKey()),d.update(this.baseString()),d.digest(b)}var e;return e=CryptoJS.HmacSHA1(this.baseString(),this.hmacKey()),"base64"===b?e.toString(CryptoJS.enc.Base64):e},base64Signature:function(){return this.hmac({encoding:"base64"})},signature:function(){return this.percentEncode(this.base64Signature())},signedUrl:function(){return this.url+"?"+this.queryString()+"&oauth_signature="+this.signature()},curl:function(){var a;return a=this,"GET"===a.method()?"curl '"+a.url+"?"+a.queryString()+"&oauth_signature="+a.signature()+"'":"POST"===a.method()||"PUT"===a.method()?a.body()?"curl -X "+a.method()+" '"+a.urlAndFields()+"' -d '"+a.body()+"' -H 'Authorization: "+a.authorizationHeader()+"' -H 'Content-Type: "+a.bodyEncoding()+"'":"curl -X "+a.method()+" '"+a.url+"' -d '"+a.queryString()+"&oauth_signature="+a.signature()+"'":"curl -X DELETE '"+a.url+"?"+a.queryString()+"&oauth_signature="+a.signature()+"'"},percentEncode:function(a){return encodeURIComponent(a).replace(/\*/g,"%2A")}},c)}}}]).provider("oauth1Client",function(){function c(a,b){var c=new RegExp("[?|&]?"+b+"=([^&;]+?)(&|#|;|$)"),d=c.exec(a);return d=d?d[1]:"",decodeURIComponent(d.replace(/\+/g,"%20"))||null}var d,e,f,g,h,i,j,k,l;this.config=function(a){d=a.consumerKey,e=a.consumerSecret,f=a.requestEndpoint,g=a.authorizeEndpoint,h=a.accessEndpoint,i=a.oauthCallback,l=a.scopes},b.isFunction(String.prototype.startsWith)||(String.prototype.startsWith=function(a){return 0===this.indexOf(a)}),this.$get=["$q","$http","oauth1Signer","oauth1Headers","oauth1AuthorizedHttp","oauthPersistence",function(m,n,o,p,q,r){function s(a){return o.create(a)}function t(a){return n.get(a.signedUrl()).then(function(a){return{oauth_token:c(a,"oauth_token"),oauth_token_secret:c(a,"oauth_token_secret"),oauth_callback_confirmed:c(a,"oauth_callback_confirmed")}})}function u(d,e,f,h,i){var j=m.defer(),k=g+"?oauth_token="+d+"&oauth_callback="+e,l=a.open(k,"_blank","location=no,clearcache=yes,hidden=yes"),n=!1;return l.addEventListener("loadstart",function(a){a.url.startsWith(e)&&(b.isFunction(h)&&h(),l.close(),j.resolve({returned_oauth_token:c(a.url,"oauth_token"),oauth_verifier:c(a.url,"oauth_verifier")}))}),l.addEventListener("loadstop",function(a){b.isFunction(i)&&i(l,a),n||(l.show(),n=!0),b.isFunction(f)&&f()}),j.promise}function v(a){return n.post(a.signedUrl()).then(function(a){return{oauth_token:c(a,"oauth_token"),oauth_token_secret:c(a,"oauth_token_secret")}})}function w(a){var b=a.oauth_token,c=a.oauth_token_secret,g=s({url:f,consumerKey:d,consumerSecret:e,token:b,tokenSecret:c});return q.create(g)}return{oAuthSigner:function(a){r.getTokenAndSecret(function(b,c){a(s({url:f,consumerKey:d,consumerSecret:e,token:b,tokenSecret:c}))})},authorize:function(a,b,c){var g=s({url:f,consumerKey:d,consumerSecret:e,callbackUrl:i,scopes:l});return t(g).then(function(d){return j=d.oauth_token,k=d.oauth_token_secret,u(d.oauth_token,i,a,b,c)}).then(function(a){return g=s({url:h,consumerKey:d,consumerSecret:e,method:"POST",token:j,tokenSecret:k,verifier:a.oauth_verifier}),v(g)}).then(function(a){return r.storeAccessToken(a),w(a)})}}}]}).service("oauth1AuthorizedHttp",["$http","oauth1Headers",function(a,c){return{create:function(d){return function(e){var f=c.getHeaders(e.url,e.method||"GET",d),g=b.extend({headers:f},e);return a(g).then(function(a){return a.data.authToken=d.token,a})}}}}]).service("oauth1Headers",[function(){return{getHeaders:function(a,b,c){var d={"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"};return c&&(c.method=b,c.url=a,d.Authorization="OAuth "+c.authorizationHeader()),d},removeAuthorizationHeader:b.noop}}])}(window,window.angular);